<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create New Customer</title>

    <link rel="stylesheet" href="/webjars/bootstrap/5.2.0/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
            integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
            integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

</head>
<body>
<form action="/customers/create" method="post" th:object="${customer}">
    <div class="container col-5">
        <div class="row text-center mb-5">
            <h1>Create New Customer</h1>
        </div>
        <div class="row">
            <div class="col-3">
                <a button class="btn btn-primary" href="/customers">Back to list</a>
            </div>
        </div>
        <div class="col">
            <table class="table">
                <tr>
                    <td class="col-1">Name</td>
                    <td class="col-2">
                        <input class="input" id="name" type="text" th:field="*{customerName}">
                    </td>
                    <td class="col-2">
                        <span th:if="${#fields.hasErrors('customerName')}" th:errors="*{customerName}"></span>
                    </td>
                </tr>
                <tr>
                    <td>Birth Day</td>
                    <td>
                        <input class="input" id="birthday" type="text" th:field="*{customerBirthday}">
                    </td>
                    <td class="col-3">
                        <span th:if="${#fields.hasErrors('customerBirthday')}" th:errors="*{customerBirthday}"></span>
                    </td>
                </tr>
                <tr>
                    <td>Gender</td>
                    <td>
                        <input class="input" id="gender" type="text" th:field="*{customerGender}">
                    </td>
                    <td class="col-3">
                        <span th:if="${#fields.hasErrors('customerGender')}" th:errors="*{customerGender}"></span>
                    </td>
                </tr>
                <tr>
                    <td>Id Card</td>
                    <td>
                        <input class="input" id="idCard" type="text" th:field="*{customerIdCard}">
                    </td>
                    <td class="col-3">
                        <span th:if="${#fields.hasErrors('customerIdCard')}" th:errors="*{customerIdCard}"></span>
                    </td>
                </tr>
                <tr>
                    <td>Phone</td>
                    <td>
                        <input class="input" id="phone" type="text" th:field="*{customerPhone}">
                    </td>
                    <td class="col-3">
                        <span th:if="${#fields.hasErrors('customerPhone')}" th:errors="*{customerPhone}"></span>
                    </td>
                </tr>
                <tr>
                    <td>Email</td>
                    <td>
                        <input class="input" id="email" type="text" th:field="*{customerEmail}">
                    </td>
                    <td class="col-3">
                        <span th:if="${#fields.hasErrors('customerEmail')}" th:errors="*{customerEmail}"></span>
                    </td>
                </tr>
                <tr>
                    <td>Address</td>
                    <td>
                        <input class="input" id="address" type="text" th:field="*{customerAddress}">
                    </td>
                    <td class="col-3">
                        <span th:if="${#fields.hasErrors('customerAddress')}" th:errors="*{customerAddress}"></span>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button class="btn btn-primary" onclick="addNewCustomer()" type="submit">Create</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</form>



</body>

<script type="text/javascript">
    function addNewCustomer() {
        let name = $('#name').val();
        let birthday = $('#birthday').val();
        let gender = $('#gender').val();
        let idCard = $('#idCard').val();
        let phone = $('#phone').val();
        let email = $('#email').val();
        let address = $('#address').val();

        let newCustomer = {
            name: name,
            birthday: birthday,
            gender: gender,
            idCard: idCard,
            phone: phone,
            email: email,
            address: address
        }

        $.ajax({
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "POST",
            data: JSON.stringify(newCustomer),
            url: "/customers/create",
            success: successHandler
        })
        event.preventDefault();
    }

    function getCustomer(customer) {
        return `<tr><td >${customer.name}</td>
                <td >${customer.birthday}</td>
                <td >${customer.gender}</td>
                <td >${customer.idCard}</td>
                <td >${customer.phone}</td>
                <td >${customer.email}</td>
                <td >${customer.address}</td>` +
            `     '<td><a class="edit" href="/customers/edit/${customer.customerId}">Edit</a></td>
                <td><a class="delete" href="/customers/delete/${customer.customerId}">Delete</a></td></tr>`;
    }

    function successHandler() {
        $.ajax({
            type: "GET",
            url: "/customers",
            success: function (data) {
                let content = '    <tr>\n' +
                    '        <td>Name</td>\n' +
                    '        <td>Birth Day</td>\n' +
                    '        <td>Gender</td>\n' +
                    '        <td>Id Card</td>\n' +
                    '        <td>Phone</td>\n' +
                    '        <td>Email</td>\n' +
                    '        <td>Address</td>\n' +
                    '    </tr>';
                for (let i = 0; i < data.length; i++) {
                    content += getCustomer(data[i]);
                }
                document.getElementById('customerList').innerHTML = content;
            }
        })
    }

</script>

</html>